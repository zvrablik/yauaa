#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2018 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
config:

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry[-2]="iPhone OS"'
    extract:
    - 'DeviceClass                 : 102:LookUp[AppleDeviceClass;agent.(1)product.comments.entry[1]]'
    - 'DeviceBrand                 : 102:"Apple"'
    - 'DeviceName                  : 102:LookUp[AppleDeviceName;agent.(1)product.comments.entry[1]]'
    - 'DeviceVersion               :   2:LookUp[AppleDeviceVersion;agent.(1)product.comments.entry[1]]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry[-3]="CPU iPhone OS"'
    extract:
    - 'DeviceClass                 : 102:LookUp[AppleDeviceClass;agent.(1)product.comments.entry[1]]'
    - 'DeviceBrand                 : 102:"Apple"'
    - 'DeviceName                  : 102:LookUp[AppleDeviceName;agent.(1)product.comments.entry[1]]'
    - 'DeviceVersion               :   2:LookUp[AppleDeviceVersion;agent.(1)product.comments.entry[1]]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry[-2]="iPhone OS"'
    extract:
    - 'DeviceClass                 : 103:LookUp[AppleDeviceClass;agent.(1)product.comments.entry[-2]]'
    - 'DeviceBrand                 : 103:"Apple"'
    - 'DeviceName                  : 103:LookUp[AppleDeviceName;agent.(1)product.comments.entry[-2]]'
    - 'DeviceVersion               :   3:LookUp[AppleDeviceVersion;agent.(1)product.comments.entry[-2]]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry[-3]="CPU iPhone OS"'
    extract:
    - 'DeviceClass                 : 103:LookUp[AppleDeviceClass;agent.(1)product.comments.entry[-2]]'
    - 'DeviceBrand                 : 103:"Apple"'
    - 'DeviceName                  : 103:LookUp[AppleDeviceName;agent.(1)product.comments.entry[-2]]'
    - 'DeviceVersion               :   3:LookUp[AppleDeviceVersion;agent.(1)product.comments.entry[-2]]'


- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry="iPhone OS"'
    extract:
    - 'DeviceClass           : 100:"Phone"'
    - 'DeviceBrand           : 100:"Apple"'
    - 'DeviceName            : 100:"iPhone"'
    - 'OperatingSystemClass  : 100:"Mobile"'
    - 'OperatingSystemName   : 100:"iOS"'
    - 'OperatingSystemVersion: 100:CleanVersion[agent.(1)product.(1)comments.entry.product.name="iPhone OS"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.product.name="iPhone OS"'
    extract:
    - 'DeviceClass           : 100:"Phone"'
    - 'DeviceBrand           : 100:"Apple"'
    - 'DeviceName            : 100:"iPhone"'
    - 'OperatingSystemClass  : 100:"Mobile"'
    - 'OperatingSystemName   : 100:"iOS"'
    - 'OperatingSystemVersion: 100:CleanVersion[agent.(1)product.(1)comments.entry.product.name="iPhone OS"^.version]'

- matcher:
    require:
    - 'IsNull[agent.(1)product.(1)comments.entry.product.name="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  20:"Desktop"'
    - 'DeviceBrand           :  20:"Apple"'
    - 'DeviceName            :  20:"Apple Macintosh"'
    - 'OperatingSystemClass  :  20:"Desktop"'
    - 'OperatingSystemName   :  20:"Mac OS X"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.product.name[-3]="Mac OS X"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-3]="Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"Intel"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"10.?"'

- matcher:
    require:
    - 'IsNull[agent.(1)product.(1)comments.entry.product.name="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  20:"Desktop"'
    - 'DeviceBrand           :  20:"Apple"'
    - 'DeviceName            :  20:"Apple Macintosh"'
    - 'DeviceCpu             :  20:"Intel"'
    - 'OperatingSystemClass  :  20:"Desktop"'
    - 'OperatingSystemName   :  20:"Mac OS X"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.product.name[-4]="Intel Mac OS X"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-4]="Intel Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"Intel"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"10.?"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-4]="PPC Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"PowerPC"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"10.?"'

- matcher:
    require:
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  20:"Desktop"'
    - 'DeviceBrand           :  20:"Apple"'
    - 'DeviceName            :  20:"Apple Macintosh"'
    - 'DeviceCpu             :  20:"PowerPC"'
    - 'OperatingSystemClass  :  20:"Desktop"'
    - 'OperatingSystemName   :  20:"Mac OS X"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.product.name[-4]="PPC Mac OS X"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-4]="PowerPC Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"PowerPC"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"10.?"'

- matcher:
    require:
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  20:"Desktop"'
    - 'DeviceBrand           :  20:"Apple"'
    - 'DeviceName            :  20:"Apple Macintosh"'
    - 'DeviceCpu             :  20:"PowerPC"'
    - 'OperatingSystemClass  :  20:"Desktop"'
    - 'OperatingSystemName   :  20:"Mac OS X"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.product.name[-4]="PowerPC Mac OS X"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-4]="PowerPC Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"PowerPC"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"10.?"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.product.name[-4]="ARM Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  20:"Desktop"'
    - 'DeviceBrand           :  20:"Apple"'
    - 'DeviceName            :  20:"Apple Macintosh"'
    - 'DeviceCpu             :  20:"ARM"'
    - 'OperatingSystemClass  :  20:"Desktop"'
    - 'OperatingSystemName   :  20:"Mac OS X"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.product.name="ARM Mac OS X"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.text[-4]="ARM Mac OS X"'
    - 'IsNull[agent.(1)product.(1)comments.entry.text="like Mac OS X"]'
    extract:
    - 'DeviceClass           :  19:"Desktop"'
    - 'DeviceBrand           :  19:"Apple"'
    - 'DeviceName            :  19:"Apple Macintosh"'
    - 'DeviceCpu             :  19:"ARM"'
    - 'OperatingSystemClass  :  19:"Desktop"'
    - 'OperatingSystemName   :  19:"Mac OS X"'
    - 'OperatingSystemVersion:  19:"X"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="CPU like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:"??"'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :  20:agent.product.name="Mobile"^.version'
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[@CPUProduct.version]'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :  20:agent.product.name="Mobile"^.version'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[@CPUProduct.version]'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[@CPUProduct.version]'


- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU iPhone OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :   20:agent.product.name="Mobile"^.version'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU iPhone OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :   20:"Mobile"'
    - 'OperatingSystemName   :   20:"iOS"'
    - 'OperatingSystemVersion:   20:CleanVersion[@CPUProduct.version]'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU iPad OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :   20:agent.product.name="Mobile"^.version'

- matcher:
    variable:
    - 'CPUProduct :agent.(1)product.(1)comments.entry.product.name="CPU iPad OS"^'
    require:
    - '@CPUProduct>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :   20:"Mobile"'
    - 'OperatingSystemName   :   20:"iOS"'
    - 'OperatingSystemVersion:   20:CleanVersion[@CPUProduct.version]'

- matcher:
    require:
    - 'agent.text="CPU like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:"??"'

- matcher:
    require:
    - 'agent.product.name="CPU"^>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :  20:agent.product.name="Mobile"^.version'

- matcher:
    require:
    - 'agent.product.name="CPU"^>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.product.name="CPU"^.version]'

- matcher:
    require:
    - 'agent.product.name="CPU OS"^>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :  20:agent.product.name="Mobile"^.version'

- matcher:
    require:
    - 'agent.product.name="CPU OS"^>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.product.name="CPU OS"^.version]'

- matcher:
    require:
    - 'agent.product.name="CPU OS"^>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.product.name="CPU OS"^.version]'

- matcher:
    require:
    - 'agent.product.name="CPU iPhone OS"^>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :   20:agent.product.name="Mobile"^.version'

- matcher:
    require:
    - 'agent.product.name="CPU iPhone OS"^>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :   20:"Mobile"'
    - 'OperatingSystemName   :   20:"iOS"'
    - 'OperatingSystemVersion:   20:CleanVersion[agent.product.name="CPU iPhone OS"^.version]'

- matcher:
    require:
    - 'agent.product.name="CPU iPad OS"^>="like Mac OS X"'
    extract:
    - 'DeviceFirmwareVersion :   20:agent.product.name="Mobile"^.version'

- matcher:
    require:
    - 'agent.product.name="CPU iPad OS"^>="like Mac OS X"'
    extract:
    - 'OperatingSystemClass  :   20:"Mobile"'
    - 'OperatingSystemName   :   20:"iOS"'
    - 'OperatingSystemVersion:   20:CleanVersion[agent.product.name="CPU iPad OS"^.version]'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(1)entry.text="Macintosh"'
    extract:
    - 'DeviceClass           :  10:"Desktop"'
    - 'DeviceBrand           :  10:"Apple"'
    - 'DeviceName            :  10:"Macintosh"'

- matcher:
    extract:
    - 'OperatingSystemClass  :  20:"Mobile"'
    - 'OperatingSystemName   :  20:"iOS"'
    - 'OperatingSystemVersion:  20:CleanVersion[agent.(1)product.(1)comments.entry.(1)product.(1)name="iOS"^.version]'

# Testcases for apps

- test:
    input:
      user_agent_string: 'bol.com/1.8.2 (iPad; iOS 9.3; Scale/2.00)'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.3'
      OperatingSystemNameVersion           : 'iOS 9.3'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'bol.com'
      AgentVersion                         : '1.8.2'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'bol.com 1.8.2'
      AgentNameVersionMajor                : 'bol.com 1'

- test:
    input:
      user_agent_string: 'bol.com/1.8.2 (iPhone; iOS 10.0; Scale/2.00)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '10.0'
      OperatingSystemNameVersion           : 'iOS 10.0'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'bol.com'
      AgentVersion                         : '1.8.2'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'bol.com 1.8.2'
      AgentNameVersionMajor                : 'bol.com 1'

- test:
    input:
      user_agent_string: 'Voordeel 1.3.0 rv:1.30 (iPhone; iPhone OS 7.1.1; nl_NL)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemNameVersion           : 'iOS 7.1.1'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Voordeel'
      AgentVersion                         : '1.3.0'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'Voordeel 1.3.0'
      AgentNameVersionMajor                : 'Voordeel 1'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 7_1_1 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) CriOS/40.0.2214.73 Mobile/11D201 Safari/9537.53'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11D201'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemNameVersion           : 'iOS 7.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '40.0'
      LayoutEngineVersionMajor             : '40'
      LayoutEngineNameVersion              : 'Blink 40.0'
      LayoutEngineNameVersionMajor         : 'Blink 40'
      AgentClass                           : 'Browser'
      AgentName                            : 'Chrome'
      AgentVersion                         : '40.0.2214.73'
      AgentVersionMajor                    : '40'
      AgentNameVersion                     : 'Chrome 40.0.2214.73'
      AgentNameVersionMajor                : 'Chrome 40'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B367 Safari/531.21.10'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '7B367'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '3.2'
      OperatingSystemNameVersion           : 'iOS 3.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '531.21.10'
      LayoutEngineVersionMajor             : '531'
      LayoutEngineNameVersion              : 'AppleWebKit 531.21.10'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 531'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '4.0.4'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Safari 4.0.4'
      AgentNameVersionMajor                : 'Safari 4'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; nl-nl) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '8C148'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '4.2.1'
      OperatingSystemNameVersion           : 'iOS 4.2.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '533.17.9'
      LayoutEngineVersionMajor             : '533'
      LayoutEngineNameVersion              : 'AppleWebKit 533.17.9'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 533'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '5.0.2'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Safari 5.0.2'
      AgentNameVersionMajor                : 'Safari 5'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS 4_3_3 like Mac OS X; nl-nl) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '8J2'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '4.3.3'
      OperatingSystemNameVersion           : 'iOS 4.3.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '533.17.9'
      LayoutEngineVersionMajor             : '533'
      LayoutEngineNameVersion              : 'AppleWebKit 533.17.9'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 533'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '5.0.2'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Safari 5.0.2'
      AgentNameVersionMajor                : 'Safari 5'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS 4_3_5 like Mac OS X; nl-nl) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8L1 Safari/6533.18.5'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '8L1'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '4.3.5'
      OperatingSystemNameVersion           : 'iOS 4.3.5'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '533.17.9'
      LayoutEngineVersionMajor             : '533'
      LayoutEngineNameVersion              : 'AppleWebKit 533.17.9'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 533'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '5.0.2'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Safari 5.0.2'
      AgentNameVersionMajor                : 'Safari 5'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad;U;CPU OS 5_1_1 like Mac OS X; zh-cn)AppleWebKit/534.46.0(KHTML, like Gecko)CriOS/19.0.1084.60 Mobile/9B206 Safari/7534.48.3'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '9B206'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '5.1.1'
      OperatingSystemNameVersion           : 'iOS 5.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.46.0'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.46.0'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Chrome'
      AgentVersion                         : '19.0.1084.60'
      AgentVersionMajor                    : '19'
      AgentNameVersion                     : 'Chrome 19.0.1084.60'
      AgentNameVersionMajor                : 'Chrome 19'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS 5_1 like Mac OS X; en-us) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9B176 Safari/7534.48.3'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '9B176'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '5.1'
      OperatingSystemNameVersion           : 'iOS 5.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.46'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '5.1'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Safari 5.1'
      AgentNameVersionMajor                : 'Safari 5'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 6_1_3 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10B329 Safari/8536.25'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '10B329'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '6.1.3'
      OperatingSystemNameVersion           : 'iOS 6.1.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.26'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.26'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '6.0'
      AgentVersionMajor                    : '6'
      AgentNameVersion                     : 'Safari 6.0'
      AgentNameVersionMajor                : 'Safari 6'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 6_1_6 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10B500 Safari/8536.25'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '10B500'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '6.1.6'
      OperatingSystemNameVersion           : 'iOS 6.1.6'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.26'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.26'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '6.0'
      AgentVersionMajor                    : '6'
      AgentNameVersion                     : 'Safari 6.0'
      AgentNameVersionMajor                : 'Safari 6'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 7_0_2 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/7.0 Mobile/11A501 Safari/9537.53'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11A501'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.0.2'
      OperatingSystemNameVersion           : 'iOS 7.0.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.1'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Safari 7.0'
      AgentNameVersionMajor                : 'Safari 7'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 7_0_3 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/7.0 Mobile/11B511 Safari/9537.53'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11B511'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.0.3'
      OperatingSystemNameVersion           : 'iOS 7.0.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.1'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Safari 7.0'
      AgentNameVersionMajor                : 'Safari 7'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 7_0_6 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/7.0 Mobile/11B651 Safari/9537.53'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11B651'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.0.6'
      OperatingSystemNameVersion           : 'iOS 7.0.6'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.1'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Safari 7.0'
      AgentNameVersionMajor                : 'Safari 7'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPod; CPU iPhone OS 6_1_6 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10B500 Safari/8536.25'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPod'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '10B500'
      DeviceVersion                        : 'iPod'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '6.1.6'
      OperatingSystemNameVersion           : 'iOS 6.1.6'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.26'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.26'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '6.0'
      AgentVersionMajor                    : '6'
      AgentNameVersion                     : 'Safari 6.0'
      AgentNameVersionMajor                : 'Safari 6'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPod touch; CPU iPhone OS 8_1_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12B440 Safari/600.1.4'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPod Touch'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12B440'
      DeviceVersion                        : 'iPod touch'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.1.2'
      OperatingSystemNameVersion           : 'iOS 8.1.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Safari 8.0'
      AgentNameVersionMajor                : 'Safari 8'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/600.3.18 (KHTML, like Gecko) Version/8.0.3 Safari/600.3.18'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple Macintosh'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS X'
      OperatingSystemVersion               : '10.10.2'
      OperatingSystemNameVersion           : 'Mac OS X 10.10.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.3.18'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.3.18'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '8.0.3'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Safari 8.0.3'
      AgentNameVersionMajor                : 'Safari 8'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 8_1_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko)'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.1.3'
      OperatingSystemNameVersion           : 'iOS 8.1.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '600.1.4'
      AgentVersionMajor                    : '600'
      AgentNameVersion                     : 'AppleWebKit 600.1.4'
      AgentNameVersionMajor                : 'AppleWebKit 600'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU iPad OS 8_0 like Mac OS X) AppleWebKit/600.1.3 (KHTML, like Gecko) Version/8.0 Mobile/12A4345d Safari/600.1.4'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12A4345d'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.0'
      OperatingSystemNameVersion           : 'iOS 8.0'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.3'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.3'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Safari 8.0'
      AgentNameVersionMajor                : 'Safari 8'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU like Mac OS X; en) AppleWebKit/420+'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'iOS ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '420'
      LayoutEngineVersionMajor             : '420'
      LayoutEngineNameVersion              : 'AppleWebKit 420'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 420'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '420'
      AgentVersionMajor                    : '420'
      AgentNameVersion                     : 'AppleWebKit 420'
      AgentNameVersionMajor                : 'AppleWebKit 420'
      AgentLanguage                        : 'English'
      AgentLanguageCode                    : 'en'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Airmail 1.3.3 rv:237 (Macintosh; Mac OS X 10.9.3; nl_NL)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple Macintosh'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS X'
      OperatingSystemVersion               : '10.9.3'
      OperatingSystemNameVersion           : 'Mac OS X 10.9.3'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Airmail'
      AgentVersion                         : '1.3.3'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'Airmail 1.3.3'
      AgentNameVersionMajor                : 'Airmail 1'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; U; CPU OS_3_2_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B500 Safari/531.21.10'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '7B500'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : 'OS.3.2.2'
      OperatingSystemNameVersion           : 'iOS OS.3.2.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '531.21.10'
      LayoutEngineVersionMajor             : '531'
      LayoutEngineNameVersion              : 'AppleWebKit 531.21.10'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 531'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '4.0.4'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Safari 4.0.4'
      AgentNameVersionMajor                : 'Safari 4'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

- matcher:
    variable:
    - 'NextProduct: agent.(2-5)product.(1)name="Mobile"^>'
    extract:
    - 'AgentClass            :  39:"Mobile App"'
    - 'AgentName             :  39:@NextProduct.name'
    - 'AgentVersion          :  39:@NextProduct.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13B143 Instagram 7.10.0 (iPhone5,4; iPhone OS 9_1; nl_NL@calendar=buddhist; nl-NL; scale=2.00; 640x1136)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13B143'
      DeviceVersion                        : 'iPhone 5c (A1507/A1516/A1529)'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.1'
      OperatingSystemNameVersion           : 'iOS 9.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '601.1.46'
      LayoutEngineVersionMajor             : '601'
      LayoutEngineNameVersion              : 'AppleWebKit 601.1.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 601'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'Instagram'
      AgentVersion                         : '7.10.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Instagram 7.10.0'
      AgentNameVersionMajor                : 'Instagram 7'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'

# Has empty version at the end
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 7_1_1 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Version/7.1 Mobile/11D201 Safari/'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11D201'
      DeviceVersion                        : 'iPad'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemNameVersion           : 'iOS 7.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.2'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '7.1'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Safari 7.1'
      AgentNameVersionMajor                : 'Safari 7'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="Mac"'
    extract:
    - 'DeviceClass                          : 100:"Desktop"'
    - 'DeviceName                           : 100:"Mac"'
    - 'DeviceBrand                          : 100:"Apple"'
    - 'OperatingSystemClass                 : 100:"Desktop"'
    - 'OperatingSystemName                  : 100:"Mac OS"'
    - 'OperatingSystemVersion               : 100:"before 10"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="Mac_68K"'
    extract:
    - 'DeviceClass                          : 100:"Desktop"'
    - 'DeviceName                           : 100:"Mac"'
    - 'DeviceBrand                          : 100:"Apple"'
    - 'OperatingSystemClass                 : 100:"Desktop"'
    - 'OperatingSystemName                  : 100:"Mac OS"'
    - 'OperatingSystemVersion               : 100:"before 10"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="Mac_PowerPC"'
    extract:
    - 'DeviceClass                          : 100:"Desktop"'
    - 'DeviceName                           : 100:"Mac"'
    - 'DeviceBrand                          : 100:"Apple"'
    - 'OperatingSystemClass                 : 100:"Desktop"'
    - 'OperatingSystemName                  : 100:"Mac OS"'
    - 'OperatingSystemVersion               : 100:"before 10"'

- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 5.23; Mac_PowerPC)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple MAC'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'PowerPC'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS'
      OperatingSystemVersion               : 'before 10'
      OperatingSystemNameVersion           : 'Mac OS before 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Internet Explorer'
      LayoutEngineVersion                  : '5.23'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Internet Explorer 5.23'
      LayoutEngineNameVersionMajor         : 'Internet Explorer 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '5.23'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Internet Explorer 5.23'
      AgentNameVersionMajor                : 'Internet Explorer 5'


- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 4.01; AOL 4.0; Mac_68K)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple MAC'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Motorola 68000'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS'
      OperatingSystemVersion               : 'before 10'
      OperatingSystemNameVersion           : 'Mac OS before 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Internet Explorer'
      LayoutEngineVersion                  : '4.01'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Internet Explorer 4.01'
      LayoutEngineNameVersionMajor         : 'Internet Explorer 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '4.01'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Internet Explorer 4.01'
      AgentNameVersionMajor                : 'Internet Explorer 4'


- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 5.0; Mac_PowerPC) Opera 5.12  [en]'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple MAC'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'PowerPC'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS'
      OperatingSystemVersion               : 'before 10'
      OperatingSystemNameVersion           : 'Mac OS before 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Presto 1'
      LayoutEngineNameVersionMajor         : 'Presto 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera'
      AgentVersion                         : '5.12'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'Opera 5.12'
      AgentNameVersionMajor                : 'Opera 5'
      AgentLanguage                        : 'English'
      AgentLanguageCode                    : 'en'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.0 Mobile/15E148 Safari/604.1'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15E148'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.3'
      OperatingSystemNameVersion           : 'iOS 11.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '11.0'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'Safari 11.0'
      AgentNameVersionMajor                : 'Safari 11'
